import{g as se,i as re}from"./index-Dn_kwerC.js";import{_ as Q,r as h,i as N,b as C,w as d,e as n,d as l,c as E,g as R,f as y,t as L,l as S,F as z,E as T,Z as ue,$ as de,m as H,o as pe,H as ce,G as me}from"./index-Yu6Nrlez.js";const ve={class:"emergency-plan"},fe={class:"plan-content"},ge={class:"plan-header"},ye={class:"steps-container"},_e={class:"contacts"},we={class:"dialog-footer"},Ae={__name:"EmergencyPlanDialog",props:{visible:Boolean,alarmType:String},emits:["update:visible"],setup($,{emit:D}){const M=D,k=h(""),_=[{type:"入侵报警",title:"校园入侵应急预案",level:"紧急",steps:[{title:"确认警情",description:"安保人员立即赶往现场确认警情"},{title:"现场处置",description:"对可疑人员进行盘查，必要时报警"},{title:"安全防范",description:"加强周边区域巡查，防止类似事件发生"}],contacts:[{name:"张三",role:"安保队长",phone:"13800138000"},{name:"李四",role:"保卫处主任",phone:"13800138001"}]},{type:"火灾报警",title:"校园火灾应急预案",level:"紧急",steps:[{title:"火情确认",description:"确认火灾位置和范围"},{title:"疏散人员",description:"立即组织人员疏散，确保人身安全"},{title:"消防处置",description:"启动消防设施，联系消防部门"}],contacts:[{name:"王五",role:"消防安全员",phone:"13800138002"}]}],i=()=>{M("update:visible",!1)},s=v=>{T.success(`正在呼叫${v.name}: ${v.phone}`)},p=()=>{T.warning(`已启动${k.value}应急预案`),i()};return(v,A)=>{const U=y("el-tag"),e=y("el-step"),f=y("el-steps"),a=y("el-table-column"),r=y("el-button"),u=y("el-table"),b=y("el-tab-pane"),w=y("el-tabs"),c=y("el-dialog");return C(),N(c,{title:"应急预案",visible:$.visible,width:"70%","before-close":i},{footer:d(()=>[n("div",we,[l(r,{type:"primary",onClick:p},{default:d(()=>A[3]||(A[3]=[S(" 启动预案 ")])),_:1}),l(r,{onClick:i},{default:d(()=>A[4]||(A[4]=[S("关闭")])),_:1})])]),default:d(()=>[n("div",ve,[l(w,{modelValue:k.value,"onUpdate:modelValue":A[0]||(A[0]=g=>k.value=g)},{default:d(()=>[(C(),E(z,null,R(_,g=>l(b,{key:g.type,label:g.type,name:g.type},{default:d(()=>[n("div",fe,[n("div",ge,[n("h3",null,L(g.title),1),l(U,{type:g.level==="紧急"?"danger":"warning"},{default:d(()=>[S(L(g.level),1)]),_:2},1032,["type"])]),n("div",ye,[l(f,{direction:"vertical",active:1},{default:d(()=>[(C(!0),E(z,null,R(g.steps,(I,P)=>(C(),N(e,{key:P,title:I.title,description:I.description},null,8,["title","description"]))),128))]),_:2},1024)]),n("div",_e,[A[2]||(A[2]=n("h4",null,"应急联系人",-1)),l(u,{data:g.contacts,border:""},{default:d(()=>[l(a,{prop:"name",label:"姓名",width:"120"}),l(a,{prop:"role",label:"职责",width:"150"}),l(a,{prop:"phone",label:"联系电话"}),l(a,{label:"操作",width:"150"},{default:d(({row:I})=>[l(r,{type:"primary",size:"small",onClick:P=>s(I)},{default:d(()=>A[1]||(A[1]=[S(" 呼叫 ")])),_:2},1032,["onClick"])]),_:1})]),_:2},1032,["data"])])])]),_:2},1032,["label","name"])),64))]),_:1},8,["modelValue"])])]),_:1},8,["visible"])}}},be=Q(Ae,[["__scopeId","data-v-c56d8f31"]]);var X={exports:{}};(function($,D){(function(M,k){$.exports=k()})(de,function(){function M(e){var f=[];return e.AMapUI&&f.push(k(e.AMapUI)),e.Loca&&f.push(_(e.Loca)),Promise.all(f)}function k(e){return new Promise(function(f,a){var r=[];if(e.plugins)for(var u=0;u<e.plugins.length;u+=1)s.AMapUI.plugins.indexOf(e.plugins[u])==-1&&r.push(e.plugins[u]);if(p.AMapUI===i.failed)a("前次请求 AMapUI 失败");else if(p.AMapUI===i.notload){p.AMapUI=i.loading,s.AMapUI.version=e.version||s.AMapUI.version,u=s.AMapUI.version;var b=document.body||document.head,w=document.createElement("script");w.type="text/javascript",w.src="https://webapi.amap.com/ui/"+u+"/main.js",w.onerror=function(c){p.AMapUI=i.failed,a("请求 AMapUI 失败")},w.onload=function(){if(p.AMapUI=i.loaded,r.length)window.AMapUI.loadUI(r,function(){for(var c=0,g=r.length;c<g;c++){var I=r[c].split("/").slice(-1)[0];window.AMapUI[I]=arguments[c]}for(f();v.AMapUI.length;)v.AMapUI.splice(0,1)[0]()});else for(f();v.AMapUI.length;)v.AMapUI.splice(0,1)[0]()},b.appendChild(w)}else p.AMapUI===i.loaded?e.version&&e.version!==s.AMapUI.version?a("不允许多个版本 AMapUI 混用"):r.length?window.AMapUI.loadUI(r,function(){for(var c=0,g=r.length;c<g;c++){var I=r[c].split("/").slice(-1)[0];window.AMapUI[I]=arguments[c]}f()}):f():e.version&&e.version!==s.AMapUI.version?a("不允许多个版本 AMapUI 混用"):v.AMapUI.push(function(c){c?a(c):r.length?window.AMapUI.loadUI(r,function(){for(var g=0,I=r.length;g<I;g++){var P=r[g].split("/").slice(-1)[0];window.AMapUI[P]=arguments[g]}f()}):f()})})}function _(e){return new Promise(function(f,a){if(p.Loca===i.failed)a("前次请求 Loca 失败");else if(p.Loca===i.notload){p.Loca=i.loading,s.Loca.version=e.version||s.Loca.version;var r=s.Loca.version,u=s.AMap.version.startsWith("2"),b=r.startsWith("2");if(u&&!b||!u&&b)a("JSAPI 与 Loca 版本不对应！！");else{u=s.key,b=document.body||document.head;var w=document.createElement("script");w.type="text/javascript",w.src="https://webapi.amap.com/loca?v="+r+"&key="+u,w.onerror=function(c){p.Loca=i.failed,a("请求 AMapUI 失败")},w.onload=function(){for(p.Loca=i.loaded,f();v.Loca.length;)v.Loca.splice(0,1)[0]()},b.appendChild(w)}}else p.Loca===i.loaded?e.version&&e.version!==s.Loca.version?a("不允许多个版本 Loca 混用"):f():e.version&&e.version!==s.Loca.version?a("不允许多个版本 Loca 混用"):v.Loca.push(function(c){c?a(c):a()})})}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var i;(function(e){e.notload="notload",e.loading="loading",e.loaded="loaded",e.failed="failed"})(i||(i={}));var s={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},p={AMap:i.notload,AMapUI:i.notload,Loca:i.notload},v={AMapUI:[],Loca:[]},A=[],U=function(e){typeof e=="function"&&(p.AMap===i.loaded?e(window.AMap):A.push(e))};return{load:function(e){return new Promise(function(f,a){if(p.AMap==i.failed)a("");else if(p.AMap==i.notload){var r=e.key,u=e.version,b=e.plugins;r?(window.AMap&&location.host!=="lbs.amap.com"&&a("禁止多种API加载方式混用"),s.key=r,s.AMap.version=u||s.AMap.version,s.AMap.plugins=b||s.AMap.plugins,p.AMap=i.loading,u=document.body||document.head,window.___onAPILoaded=function(c){if(delete window.___onAPILoaded,c)p.AMap=i.failed,a(c);else for(p.AMap=i.loaded,M(e).then(function(){f(window.AMap)}).catch(a);A.length;)A.splice(0,1)[0]()},b=document.createElement("script"),b.type="text/javascript",b.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+s.AMap.version+"&key="+r+"&plugin="+s.AMap.plugins.join(","),b.onerror=function(c){p.AMap=i.failed,a(c)},u.appendChild(b)):a("请填写key")}else if(p.AMap==i.loaded)if(e.key&&e.key!==s.key)a("多个不一致的 key");else if(e.version&&e.version!==s.AMap.version)a("不允许多个版本 JSAPI 混用");else{if(r=[],e.plugins)for(u=0;u<e.plugins.length;u+=1)s.AMap.plugins.indexOf(e.plugins[u])==-1&&r.push(e.plugins[u]);r.length?window.AMap.plugin(r,function(){M(e).then(function(){f(window.AMap)}).catch(a)}):M(e).then(function(){f(window.AMap)}).catch(a)}else if(e.key&&e.key!==s.key)a("多个不一致的 key");else if(e.version&&e.version!==s.AMap.version)a("不允许多个版本 JSAPI 混用");else{var w=[];if(e.plugins)for(u=0;u<e.plugins.length;u+=1)s.AMap.plugins.indexOf(e.plugins[u])==-1&&w.push(e.plugins[u]);U(function(){w.length?window.AMap.plugin(w,function(){M(e).then(function(){f(window.AMap)}).catch(a)}):M(e).then(function(){f(window.AMap)}).catch(a)})}})},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,s={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},p={AMap:i.notload,AMapUI:i.notload,Loca:i.notload},v={AMap:[],AMapUI:[],Loca:[]}}}})})(X);var Me=X.exports;const Z=ue(Me),he={class:"alarm-management"},Ie={class:"top-bar"},Se={class:"search-section",style:{display:"flex","align-items":"center",gap:"16px"}},Ue={class:"action-buttons",style:{display:"flex",gap:"8px"}},ke={class:"main-content"},Le={class:"left-panel"},Ce={class:"mock-map-container"},De={class:"map-legend"},xe={class:"alarm-list"},Te={class:"right-panel"},Pe={class:"detail-header"},Ee={class:"detail-actions",style:{display:"flex",gap:"8px"}},Oe={class:"detail-content"},Ve={class:"detail-item"},Re={class:"detail-item"},ze={class:"detail-item"},$e={class:"detail-item"},Be={class:"detail-item"},Fe={class:"statistics-header"},je={class:"statistics-content"},We={class:"chart-container"},Ne={__name:"AlarmManagement",setup($){const D=h(""),M=h(""),k=h([]),_=h(null),i=h("today"),s=["入侵报警","火灾报警","求助报警","设备故障","异常行为"],p=h(null),v=h(null),A=h([]);h({total:156,processing:23,resolved:133});const U=h([{id:1,type:"入侵报警",time:new Date(Date.now()-5*24*60*60*1e3).toISOString().slice(0,19).replace("T"," "),location:"图书馆后门",severity:"高",status:"处理中",description:"发现可疑人员尝试翻越围墙",coordinates:{longitude:116.5862,latitude:35.5501},processRecords:[{time:new Date(Date.now()-5*24*60*60*1e3).toISOString().slice(0,19).replace("T"," "),action:"系统自动报警"},{time:new Date(Date.now()-4*24*60*60*1e3).toISOString().slice(0,19).replace("T"," "),action:"安保人员已派出"}]},{id:2,type:"火灾报警",time:new Date(Date.now()-10*24*60*60*1e3).toISOString().slice(0,19).replace("T"," "),location:"教学楼",severity:"高",status:"处理中",description:"发现烟雾报警",coordinates:{longitude:116.5862,latitude:35.5501},processRecords:[{time:new Date(Date.now()-10*24*60*60*1e3).toISOString().slice(0,19).replace("T"," "),action:"系统自动报警"}]},{id:3,type:"求助报警",time:new Date(Date.now()-15*24*60*60*1e3).toISOString().slice(0,19).replace("T"," "),location:"宿舍楼",severity:"中",status:"待处理",description:"学生按下紧急求助按钮",coordinates:{longitude:116.5862,latitude:35.5501},processRecords:[{time:new Date(Date.now()-15*24*60*60*1e3).toISOString().slice(0,19).replace("T"," "),action:"系统自动报警"}]},{id:4,type:"设备故障",time:new Date(Date.now()-20*24*60*60*1e3).toISOString().slice(0,19).replace("T"," "),location:"实验室",severity:"低",status:"已处理",description:"实验室设备故障",coordinates:{longitude:116.5862,latitude:35.5501},processRecords:[{time:new Date(Date.now()-20*24*60*60*1e3).toISOString().slice(0,19).replace("T"," "),action:"技术人员已到达"},{time:new Date(Date.now()-19*24*60*60*1e3).toISOString().slice(0,19).replace("T"," "),action:"设备已修复"}]},{id:5,type:"异常行为",time:new Date(Date.now()-25*24*60*60*1e3).toISOString().slice(0,19).replace("T"," "),location:"操场",severity:"中",status:"待处理",description:"发现可疑人员在操场徘徊",coordinates:{longitude:116.5862,latitude:35.5501},processRecords:[{time:new Date(Date.now()-25*24*60*60*1e3).toISOString().slice(0,19).replace("T"," "),action:"系统自动报警"}]},{id:6,type:"火灾报警",time:new Date(Date.now()-30*24*60*60*1e3).toISOString().slice(0,19).replace("T"," "),location:"食堂",severity:"高",status:"已处理",description:"食堂烟雾报警",coordinates:{longitude:116.5862,latitude:35.5501},processRecords:[{time:new Date(Date.now()-30*24*60*60*1e3).toISOString().slice(0,19).replace("T"," "),action:"系统自动报警"},{time:new Date(Date.now()-29*24*60*60*1e3).toISOString().slice(0,19).replace("T"," "),action:"安保人员已到达"}]}]),e=H(()=>U.value.filter(o=>!(D.value&&!o.location.includes(D.value)||M.value&&o.type!==M.value))),f=H(()=>U.value.filter(o=>o.status!=="已处理")),a=o=>{_.value=o},r=async()=>{if(D.value){const o=await Z.load({key:"1a2f2df0472a2170783ca5d5e7a3c7e0",version:"2.0",plugins:["AMap.Autocomplete","AMap.Geocoder"]});new o.Autocomplete({input:"searchKey"}).search(D.value,(F,x)=>{if(F==="complete"&&x.tips){const O=x.tips[0],j=O.location.split(",").map(Number);v.value.setCenter(j),new o.Marker({position:j,title:O.name,map:v.value})}else T.error("未找到相关地点")})}},u=o=>({入侵报警:"#F56C6C",火灾报警:"#E6A23C",求助报警:"#409EFF",设备故障:"#909399",异常行为:"#67C23A"})[o]||"#909399",b=o=>({高:"danger",中:"warning",低:"info"})[o]||"info",w=o=>({处理中:"warning",已处理:"success",待处理:"info"})[o]||"info",c=()=>{if(!_.value)return;const o=U.value.findIndex(t=>t.id===_.value.id);o!==-1&&(U.value[o].status="已处理",T.success("报警已处理"),_.value=null)},g=()=>{if(!_.value)return;const o=U.value.findIndex(t=>t.id===_.value.id);o!==-1&&(U.value[o].status="紧急处理",T.warning("已启动紧急处理流程"),_.value=null)},I=()=>{J.value=!0},P=()=>{T.success("报表导出成功")},Y=o=>({入侵报警:"danger",火灾报警:"danger",求助报警:"warning",设备故障:"info",异常行为:"warning"})[o.type]||"info",J=h(!1),B=h(null),ee=()=>{me(()=>{if(B.value){const o=re(B.value),t={title:{text:"报警类型分布",left:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"horizontal",bottom:"bottom"},series:[{name:"报警类型",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!0,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!0,formatter:"{b}: {c}件"},emphasis:{label:{show:!0,fontSize:"16",fontWeight:"bold"}},data:[{value:35,name:"入侵报警",itemStyle:{color:"#F56C6C"}},{value:25,name:"火灾报警",itemStyle:{color:"#E6A23C"}},{value:20,name:"求助报警",itemStyle:{color:"#409EFF"}},{value:15,name:"设备故障",itemStyle:{color:"#909399"}},{value:5,name:"异常行为",itemStyle:{color:"#67C23A"}}]}]};o.setOption(t)}else console.error("类型分布图表容器未找到")})},te=async()=>{try{const o=await Z.load({key:"1a2f2df0472a2170783ca5d5e7a3c7e0",version:"1.4.15",plugins:["AMap.Scale","AMap.ToolBar","AMap.MapType"]});v.value=new o.Map(p.value,{zoom:17,center:[116.5862,35.5501],viewMode:"2D",resizeEnable:!0,pitch:0,rotation:0,layers:[new o.TileLayer,new o.TileLayer.RoadNet]}),v.value.addControl(new o.MapType({defaultType:0,showRoad:!0})),v.value.addControl(new o.Scale({position:"LB"})),v.value.addControl(new o.ToolBar({position:"RB"})),new o.Marker({position:[116.5862,35.5501],title:"济宁市兖州区第一中学",label:{content:"济宁市兖州区第一中学",direction:"top"}}).setMap(v.value),oe()}catch(o){console.error("地图加载失败:",o),T.error("地图加载失败")}},oe=()=>{A.value.forEach(o=>o.remove()),A.value=[],f.value.forEach(o=>{u(o.type);const t=new AMap.Marker({position:[o.coordinates.longitude,o.coordinates.latitude],title:o.type,label:{content:o.type,direction:"top"},icon:new AMap.Icon({size:new AMap.Size(30,30),image:o.type==="异常行为"?"path/to/your/icon.png":"path/to/default/icon.png",imageSize:new AMap.Size(30,30)})});t.on("click",()=>{a(o),new AMap.InfoWindow({content:`<div>${o.type}: ${o.description}</div>`,position:t.getPosition()}).open(v.value,t.getPosition())}),t.setMap(v.value),A.value.push(t)})};return pe(()=>{te(),ee();const o=U.value.find(t=>t.type==="异常行为");o&&(_.value=o),window.addEventListener("resize",()=>{v.value&&v.value.resize();const t=se(B.value);t==null||t.resize()})}),(o,t)=>{var q;const F=y("el-input"),x=y("el-option"),O=y("el-select"),j=y("el-date-picker"),W=y("el-button"),G=y("el-tag"),V=y("el-table-column"),ne=y("el-table"),ae=y("el-timeline-item"),le=y("el-timeline"),K=y("el-card");return C(),E("div",he,[n("div",Ie,[n("div",Se,[l(F,{modelValue:D.value,"onUpdate:modelValue":t[0]||(t[0]=m=>D.value=m),placeholder:"搜索地点","prefix-icon":"Search",clearable:"",onInput:r,style:{width:"300px"}},null,8,["modelValue"]),l(O,{modelValue:M.value,"onUpdate:modelValue":t[1]||(t[1]=m=>M.value=m),placeholder:"报警类型",style:{width:"150px"}},{default:d(()=>[(C(),E(z,null,R(s,m=>l(x,{key:m,label:m,value:m},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),l(j,{modelValue:k.value,"onUpdate:modelValue":t[2]||(t[2]=m=>k.value=m),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"250px"}},null,8,["modelValue"])]),n("div",Ue,[l(W,{type:"primary",onClick:P},{default:d(()=>t[5]||(t[5]=[S("导出报表")])),_:1}),l(W,{type:"warning",onClick:I},{default:d(()=>t[6]||(t[6]=[S("应急预案")])),_:1})])]),n("div",ke,[n("div",Le,[n("div",Ce,[n("div",{class:"amap-wrapper",ref_key:"mapContainer",ref:p},null,512),n("div",De,[t[7]||(t[7]=n("div",{class:"legend-title"},"报警类型",-1)),(C(),E(z,null,R(s,m=>n("div",{class:"legend-item",key:m},[l(G,{type:Y({type:m})},{default:d(()=>[S(L(m),1)]),_:2},1032,["type"])])),64))])]),n("div",xe,[l(ne,{data:e.value,onRowClick:a},{default:d(()=>[l(V,{prop:"time",label:"时间",width:"150"}),l(V,{prop:"type",label:"类型",width:"120"}),l(V,{prop:"location",label:"位置"}),l(V,{label:"等级",width:"80"},{default:d(({row:m})=>[l(G,{type:b(m.severity)},{default:d(()=>[S(L(m.severity),1)]),_:2},1032,["type"])]),_:1}),l(V,{label:"状态",width:"100"},{default:d(({row:m})=>[l(G,{type:w(m.status)},{default:d(()=>[S(L(m.status),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])])]),n("div",Te,[_.value?(C(),N(K,{key:0,class:"alarm-detail"},{header:d(()=>[n("div",Pe,[t[10]||(t[10]=n("span",null,"报警详情",-1)),n("div",Ee,[l(W,{type:"success",size:"small",onClick:c},{default:d(()=>t[8]||(t[8]=[S("处理")])),_:1}),l(W,{type:"danger",size:"small",onClick:g},{default:d(()=>t[9]||(t[9]=[S("紧急处理")])),_:1})])])]),default:d(()=>[n("div",Oe,[n("div",Ve,[t[11]||(t[11]=n("span",{class:"label"},"报警类型：",-1)),n("span",null,L(_.value.type),1)]),n("div",Re,[t[12]||(t[12]=n("span",{class:"label"},"报警时间：",-1)),n("span",null,L(_.value.time),1)]),n("div",ze,[t[13]||(t[13]=n("span",{class:"label"},"报警位置：",-1)),n("span",null,L(_.value.location),1)]),n("div",$e,[t[14]||(t[14]=n("span",{class:"label"},"报警描述：",-1)),n("p",null,L(_.value.description),1)]),n("div",Be,[t[15]||(t[15]=n("span",{class:"label"},"处理记录：",-1)),l(le,null,{default:d(()=>[(C(!0),E(z,null,R(_.value.processRecords,(m,ie)=>(C(),N(ae,{key:ie,timestamp:m.time},{default:d(()=>[S(L(m.action),1)]),_:2},1032,["timestamp"]))),128))]),_:1})])])]),_:1})):ce("",!0),l(K,{class:"statistics-panel"},{header:d(()=>[n("div",Fe,[t[16]||(t[16]=n("span",null,"报警类型分布",-1)),l(O,{modelValue:i.value,"onUpdate:modelValue":t[3]||(t[3]=m=>i.value=m),size:"small"},{default:d(()=>[l(x,{label:"今日",value:"today"}),l(x,{label:"本周",value:"week"}),l(x,{label:"本月",value:"month"})]),_:1},8,["modelValue"])])]),default:d(()=>[n("div",je,[n("div",We,[n("div",{class:"chart",ref_key:"typeChart",ref:B},null,512)])])]),_:1})])]),l(be,{visible:J.value,"onUpdate:visible":t[4]||(t[4]=m=>J.value=m),"alarm-type":(q=_.value)==null?void 0:q.type},null,8,["visible","alarm-type"])])}}},Ke=Q(Ne,[["__scopeId","data-v-d83611d4"]]);export{Ke as default};
